{% extends "base.html" %}
{% block content %}
<h2>Our Cakes Menu <i class="fa-solid fa-cake-candles"></i></h2>

<div class="menu-grid">
    {% for cake in cakes %}
    <div class="menu-item">
        <img src="{{ url_for('static', filename='images/' + cake.img) }}" alt="{{ cake.name }}">
        <h3>{{ cake.name }}</h3>
        <p>RM {{ "%.2f"|format(cake.price) }}</p>

        <div class="menu-actions">
            <div class="quantity">
                <button class="qty-btn minus">âˆ’</button>
                <span class="qty-value">1</span>
                <button class="qty-btn plus">+</button>
            </div>

            {% if current_user.is_authenticated %}
                <button class="add-cart-btn"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button>
            {% else %}
                <button class="add-cart-btn login-prompt"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<script>
    // Quantity controls (already present)
    document.querySelectorAll('.menu-item').forEach(item => {
        const minus = item.querySelector('.minus');
        const plus = item.querySelector('.plus');
        const value = item.querySelector('.qty-value');
        let qty = 1;

        minus.addEventListener('click', () => {
            if (qty > 1) qty--;
            value.textContent = qty;
        });

        plus.addEventListener('click', () => {
            qty++;
            value.textContent = qty;
        });
    });

    // Handle login prompts for unauthenticated users
    document.querySelectorAll('.login-prompt').forEach(btn => {
        btn.addEventListener('click', () => {
            Swal.fire({
                icon: 'info',
                title: 'Login Required',
                text: 'Please login to add items to your cart',
                confirmButtonColor: '#ff69b4',
                confirmButtonText: 'Login'
            }).then(() => {
                window.location.href = "{{ url_for('login_user_route') }}";
            });
        });
    });
</script>
{% endblock %}
