{% extends "base.html" %}
{% block content %}
<h2>Our Cakes Menu <i class="fa-solid fa-cake-candles"></i></h2>

<div class="menu-grid">
    {% for cake in cakes %}
    <div class="menu-item" data-name="{{ cake.name }}" data-description="{{ cake.description }}" data-img="{{ url_for('static', filename='images/' + cake.img) }}">
        <img src="{{ url_for('static', filename='images/' + cake.img) }}" alt="{{ cake.name }}">
        <h3>{{ cake.name }}</h3>
        <p>RM {{ "%.2f"|format(cake.price) }}</p>

        <!-- Menu actions (not affected by hover) -->
        <div class="menu-actions">
            <div class="quantity">
                <button class="qty-btn minus">âˆ’</button>
                <span class="qty-value">1</span>
                <button class="qty-btn plus">+</button>
            </div>

            {% if current_user.is_authenticated %}
                <button class="add-cart-btn">Add to Cart</button>
            {% else %}
                <button class="add-cart-btn login-prompt">Add to Cart</button>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- Modal for cake details -->
<div id="cakeModal" class="cake-modal">
    <div class="cake-modal-content">
        <span class="close-modal">&times;</span>
        <img id="modal-img" src="" alt="Cake Image">
        <h3 id="modal-title"></h3>
        <p id="modal-desc"></p>
    </div>
</div>

<script>
    // Quantity control
    document.querySelectorAll('.menu-item').forEach(item => {
        const minus = item.querySelector('.minus');
        const plus = item.querySelector('.plus');
        const value = item.querySelector('.qty-value');
        let qty = 1;

        minus.addEventListener('click', e => {
            e.stopPropagation(); // prevent modal trigger
            if (qty > 1) qty--;
            value.textContent = qty;
        });

        plus.addEventListener('click', e => {
            e.stopPropagation();
            qty++;
            value.textContent = qty;
        });
    });

    // Login prompt
    document.querySelectorAll('.login-prompt').forEach(btn => {
        btn.addEventListener('click', e => {
            e.stopPropagation();
            Swal.fire({
                icon: 'info',
                title: 'Login Required',
                text: 'Please login to add items to your cart',
                confirmButtonColor: '#ff69b4',
                confirmButtonText: 'Login'
            }).then(() => {
                window.location.href = "{{ url_for('login_user_route') }}";
            });
        });
    });

    //  Modal interaction
    const modal = document.getElementById('cakeModal');
    const modalImg = document.getElementById('modal-img');
    const modalTitle = document.getElementById('modal-title');
    const modalDesc = document.getElementById('modal-desc');
    const closeModal = document.querySelector('.close-modal');

    document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', () => {
            modal.style.display = 'flex';
            modalImg.src = item.dataset.img;
            modalTitle.textContent = item.dataset.name;
            modalDesc.textContent = item.dataset.description;
        });
    });

    closeModal.addEventListener('click', () => modal.style.display = 'none');
    modal.addEventListener('click', e => {
        if (e.target === modal) modal.style.display = 'none';
    });
</script>
{% endblock %}